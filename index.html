<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horarios Academia - MODO DIAGNÓSTICO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --primary: #003366; --bg: #f4f7f9; }
        body { font-family: sans-serif; background-color: var(--bg); padding: 20px; text-align: center; }
        .container { background: white; padding: 30px; border-radius: 12px; max-width: 600px; margin: 0 auto; }
        input { padding: 10px; width: 80%; font-size: 16px; text-align: center; }
        button { padding: 10px 20px; background: var(--primary); color: white; border: none; cursor: pointer; font-size: 16px; margin-top: 10px;}
        #log-area { 
            background: #eee; color: #333; padding: 10px; margin-top: 20px; 
            text-align: left; font-family: monospace; font-size: 12px; 
            height: 150px; overflow-y: scroll; border: 1px solid #999;
        }
        .dia-card { background: #eef2f7; margin: 10px 0; padding: 10px; border-left: 5px solid var(--primary); text-align: left; }
        .hora-tag { font-weight: bold; font-size: 18px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Diagnóstico de Horario</h2>
    <p>Escribe el nombre y mira el cuadro gris de abajo.</p>
    
    <form id="searchForm">
        <input type="text" id="alumnoInput" placeholder="Nombre exacto" autocomplete="off">
        <button type="submit">BUSCAR</button>
    </form>

    <div id="resultado"></div>

    <div id="log-area">Esperando búsqueda...</div>
</div>

<script>
    const urls = {
        "Lunes": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTa_AjdQ-TzUs68ciZCnbgsUzqRF78m8e-oMrmbrorAsXjaFckYe6JQAzyKFlY6jcvWTMVZ3UDcqxMx/pub?gid=0&single=true&output=csv",
        "Martes": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTa_AjdQ-TzUs68ciZCnbgsUzqRF78m8e-oMrmbrorAsXjaFckYe6JQAzyKFlY6jcvWTMVZ3UDcqxMx/pub?gid=1905233272&single=true&output=tsv",
        "Miércoles": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTa_AjdQ-TzUs68ciZCnbgsUzqRF78m8e-oMrmbrorAsXjaFckYe6JQAzyKFlY6jcvWTMVZ3UDcqxMx/pub?gid=745373517&single=true&output=tsv",
        "Jueves": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTa_AjdQ-TzUs68ciZCnbgsUzqRF78m8e-oMrmbrorAsXjaFckYe6JQAzyKFlY6jcvWTMVZ3UDcqxMx/pub?gid=314818236&single=true&output=tsv",
        "Viernes": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTa_AjdQ-TzUs68ciZCnbgsUzqRF78m8e-oMrmbrorAsXjaFckYe6JQAzyKFlY6jcvWTMVZ3UDcqxMx/pub?gid=1396865785&single=true&output=tsv"
    };

    function log(msg) {
        const area = document.getElementById('log-area');
        area.innerHTML += `<div>> ${msg}</div>`;
        area.scrollTop = area.scrollHeight;
    }

    // Funciones de tiempo
    function timeToMins(t) { if(!t) return 0; const [h, m] = t.split(':').map(Number); return h * 60 + m; }
    function minsToTime(m) { const hh = Math.floor(m / 60).toString().padStart(2,'0'); const mm = (m % 60).toString().padStart(2,'0'); return `${hh}:${mm}`; }
    function agruparHoras(lista) {
        if(!lista.length) return [];
        let times = lista.map(timeToMins).sort((a,b)=>a-b);
        let res = []; let ini = times[0]; let fin = times[0]+30;
        for(let i=1;i<times.length;i++){ if(times[i]===fin){fin+=30}else{res.push(`${minsToTime(ini)}-${minsToTime(fin)}`);ini=times[i];fin=times[i]+30}}
        res.push(`${minsToTime(ini)}-${minsToTime(fin)}`); return res;
    }

    document.
