<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario de Ex치menes CSE</title>
    <link rel="icon" type="image/png" href="https://github.com/cse-elisagundin/horarios_alumnos/blob/main/image.png?raw=true">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        :root { 
            --c-primary: #243c7a; /* Azul corporativo */
            --c-accent: #fa65c3;  /* Rosa corporativo */
            --bg-body: #f4f6f9; 
            --bg-card: #ffffff;
            --c-text-light: #666;
        }

        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg-body); margin: 0; padding: 20px; color: #333; }
        
        .container { max-width: 1000px; margin: 0 auto; background: var(--bg-card); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(36, 60, 122, 0.08); }

        /* HEADER */
        header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; margin-bottom: 30px; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; }
        
        .brand { display: flex; align-items: center; gap: 15px; }
        .brand img { height: 50px; }
        .brand h1 { margin: 0; color: var(--c-primary); font-size: 24px; text-transform: uppercase; letter-spacing: 0.5px; }

        /* CONTROLES Y SELECT */
        .controls { display: flex; align-items: center; }
        .select2-container .select2-selection--single {
            height: 42px !important;
            border-radius: 50px !important;
            border: 2px solid #eee !important;
            padding: 5px 15px;
            display: flex;
            align-items: center;
            background-color: #fafafa;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow { top: 8px !important; right: 12px !important; }

        /* NAVEGACI칍N MES */
        .month-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; background: var(--c-primary); color: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(36, 60, 122, 0.2); }
        .nav-btn { background: rgba(255,255,255,0.15); border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 700; transition: 0.2s; font-size: 13px; }
        .nav-btn:hover { background: var(--c-accent); transform: translateY(-1px); }
        .current-month { font-size: 18px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }

        /* --- ESTILOS TIMELINE (VISTA A) --- */
        .timeline-container { display: flex; flex-direction: column; gap: 0; }

        .timeline-row { 
            display: flex; 
            border-bottom: 1px solid #f0f0f0; 
            padding: 15px 0; 
            transition: background 0.2s;
        }
        .timeline-row:last-child { border-bottom: none; }
        .timeline-row:hover { background-color: #fafbff; }
        
        /* Columna FECHA (Izquierda) */
        .date-col { 
            width: 90px; 
            flex-shrink: 0; 
            text-align: center; 
            border-right: 2px solid #f0f0f0; 
            margin-right: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .date-col .day-num { font-size: 28px; font-weight: 900; color: var(--c-primary); line-height: 1; }
        .date-col .day-name { font-size: 13px; font-weight: 700; color: #999; text-transform: uppercase; margin-top: 4px; }
        
        /* Si es HOY */
        .timeline-row.today .date-col .day-num { color: var(--c-accent); }
        .timeline-row.today .date-col { border-right-color: var(--c-accent); }
        .timeline-row.today { background-color: #fff5fa; }

        /* Columna EX츼MENES (Derecha) */
        .exams-col { 
            flex-grow: 1; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
            align-items: center; 
        }

        /* La "P칤ldora" del examen */
        .exam-pill {
            display: inline-flex;
            flex-direction: column;
            background: white;
            border: 1px solid #e0e0e0;
            border-left: 4px solid var(--c-primary);
            padding: 6px 12px;
            border-radius: 8px;
            min-width: 120px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            transition: all 0.2s;
        }
        .exam-pill:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.08); border-left-color: var(--c-accent); }
        
        .pill-subject { font-size: 11px; font-weight: 800; color: var(--c-accent); text-transform: uppercase; margin-bottom: 2px; }
        .pill-student { font-size: 14px; font-weight: 700; color: #333; }

        /* Mensaje de d칤a vac칤o */
        .no-exams { color: #ccc; font-size: 13px; font-style: italic; padding: 5px; }

        .loading { text-align: center; padding: 50px; color: #999; font-style: italic; }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .brand h1 { display: none; }
            .container { padding: 15px; }
            .timeline-row { flex-direction: column; gap: 10px; }
            .date-col { width: 100%; border-right: none; border-bottom: 1px solid #eee; flex-direction: row; gap: 10px; justify-content: flex-start; padding-bottom: 5px; margin-bottom: 5px; }
            .date-col .day-num { font-size: 20px; }
            .exam-pill { width: 100%; flex-direction: row; justify-content: space-between; align-items: center; }
            .pill-subject { margin-bottom: 0; }
            .select2-container { width: 100% !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="brand">
            <img src="https://github.com/cse-elisagundin/horarios_alumnos/blob/main/image.png?raw=true" alt="Logo CSE">
            <h1>Ex치menes</h1>
        </div>
        <div class="controls">
            <select id="alumnoSelect" style="width: 300px;">
                <option value="todos">游논 Ver todos los alumnos</option>
            </select>
        </div>
    </header>

    <div class="month-nav">
        <button class="nav-btn" onclick="cambiarMes(-1)">&#10094; ANTERIOR</button>
        <span class="current-month" id="monthDisplay">CARGANDO...</span>
        <button class="nav-btn" onclick="cambiarMes(1)">SIGUIENTE &#10095;</button>
    </div>

    <div id="timeline" class="timeline-container">
        <div class="loading">Cargando datos...</div>
    </div>
</div>

<script>
    // ==========================================
    // 游댕 TUS ENLACES (YA CONFIGURADOS)
    // ==========================================
    const CSV_EXAMENES = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrK53aJ-n_g-6-yrsASWYrkCc47WpA3uKQGXvuixv0OZ5BkzbTRJrDI0Sat2qxKRvX7NdOsjlsFrpR/pub?gid=0&single=true&output=csv";
    const CSV_ALUMNOS  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQZF-mJ-JVs1nimm4uu9UV0ibMcXhhEnZZjbrGLWJO4YspYonC9vu1vIywZQLTxsvgw2GPv7wATNZL/pub?gid=130634044&single=true&output=csv";
    // ==========================================

    let examenes = [];
    let alumnosLista = [];
    let mesVisualizado = new Date();

    $(document).ready(function() {
        $('#alumnoSelect').select2({ placeholder: "Buscar alumno...", allowClear: false });
        $('#alumnoSelect').on('change', function() { renderTimeline(); });
        initApp();
    });

    function initApp() {
        // 1. Cargar Alumnos
        Papa.parse(CSV_ALUMNOS + "&t=" + Date.now(), {
            download: true, header: false,
            complete: function(res) {
                let raw = res.data.map(r => r[0]).filter(n => n && n.trim() !== "" && n.toLowerCase() !== "nombre");
                alumnosLista = [...new Set(raw)].sort(); 
                llenarSelectAlumnos();
                // 2. Cargar Ex치menes
                cargarExamenes();
            }
        });
    }

    function llenarSelectAlumnos() {
        const select = $('#alumnoSelect');
        alumnosLista.forEach(nombre => { select.append(new Option(nombre, nombre)); });
    }

    function cargarExamenes() {
        Papa.parse(CSV_EXAMENES + "&t=" + Date.now(), {
            download: true, header: false,
            complete: function(results) {
                procesarExamenes(results.data);
                renderTimeline();
            }
        });
    }

    function procesarExamenes(data) {
        examenes = data.slice(1).map(row => {
            if(!row[0]) return null;
            return {
                fecha: row[0].trim(), // YYYY-MM-DD
                asignatura: (row[1] || "").trim(),
                alumno: (row[2] || "").trim()
            };
        }).filter(item => item !== null);
    }

    // --- RENDERIZADO TIPO TIMELINE ---
    function renderTimeline() {
        const container = document.getElementById('timeline');
        container.innerHTML = "";

        const alumnoSeleccionado = $('#alumnoSelect').val();
        const year = mesVisualizado.getFullYear();
        const month = mesVisualizado.getMonth();
        
        // Actualizar t칤tulo
        const nombreMes = mesVisualizado.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
        document.getElementById('monthDisplay').textContent = nombreMes;

        const diasEnMes = new Date(year, month + 1, 0).getDate();
        const hoyStr = new Date().toISOString().split('T')[0];
        const diasSemana = ["DOM", "LUN", "MAR", "MI칄", "JUE", "VIE", "S츼B"];

        // Bucle d칤a a d칤a
        for(let dia = 1; dia <= diasEnMes; dia++) {
            const fechaObj = new Date(year, month, dia);
            const fechaStr = `${year}-${String(month+1).padStart(2,'0')}-${String(dia).padStart(2,'0')}`;
            const diaSemanaStr = diasSemana[fechaObj.getDay()];
            
            // FILTRADO
            const eventosDia = examenes.filter(ex => {
                const coincideFecha = ex.fecha === fechaStr;
                const coincideAlumno = (alumnoSeleccionado === "todos") || (ex.alumno === alumnoSeleccionado);
                return coincideFecha && coincideAlumno;
            });

            // Si NO hay ex치menes y no estamos filtrando por un alumno espec칤fico, 
            // podemos decidir si mostrar el d칤a vac칤o o no. 
            // Para que se vea calendario completo, mostramos todo, pero visualmente tenue.
            
            const esHoy = (fechaStr === hoyStr);
            const row = document.createElement('div');
            row.className = `timeline-row ${esHoy ? 'today' : ''}`;

            // Columna IZQ: Fecha
            const dateCol = document.createElement('div');
            dateCol.className = "date-col";
            dateCol.innerHTML = `
                <span class="day-num">${dia}</span>
                <span class="day-name">${diaSemanaStr}</span>
            `;
            
            // Columna DER: Ex치menes
            const examsCol = document.createElement('div');
            examsCol.className = "exams-col";

            if (eventosDia.length > 0) {
                eventosDia.forEach(ex => {
                    const pill = document.createElement('div');
                    pill.className = "exam-pill";
                    pill.innerHTML = `
                        <span class="pill-subject">${ex.asignatura}</span>
                        <span class="pill-student">${ex.alumno}</span>
                    `;
                    examsCol.appendChild(pill);
                });
            } else {
                // D칤a vac칤o
                const noExam = document.createElement('div');
                noExam.className = "no-exams";
                noExam.textContent = "-";
                examsCol.appendChild(noExam);
            }

            row.appendChild(dateCol);
            row.appendChild(examsCol);
            container.appendChild(row);
        }
    }

    function cambiarMes(delta) {
        mesVisualizado.setMonth(mesVisualizado.getMonth() + delta);
        renderTimeline();
    }
</script>

</body>
</html>
